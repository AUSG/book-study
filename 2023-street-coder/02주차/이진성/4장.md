## 4장 - 맛있는 테스트

### 서론

- 개발자들이 테스트를 싫어하는 이유는 테스트를 소프트웨어 개발과 분리된 것으로 보기 때문

### 1. 테스트의 유형

- 자동테스트
    - 단위테스트 : 가장 작은 범위의 테스트
    - 통합테스트 : 여러가지의 컴포넌트가 함께 잘 동작하는지 테스트
- 위험을 감수하자 - 프로덕션 환경에서 테스트
    - 일반적으로는 프로덕션 환경에서 테스트 하는 것은 고객에게 영향이 갈 수 있으므로 나쁜 테스트로 간주됨
    - 하지만 중요하지 않은 로직의 경우 그냥 작은 고장을 감수하고 **빨리** 고치는 편이 나음
- 적합한 테스트 방법 선택?
    - 비용과 위험을 고려하여 적절한 테스트를 선택해야한다.
    - “내 컴퓨터에서는 잘 돌아간다”만큼 사실 비싼 비용을 치루는 것은 없다.
    - 자동화된 테스트를 하는 것이 좋다.

### 2. 걱정을 멈추고 테스트를 사랑하는 법

- 단위 테스트는 일반적으로 단위 함수(단위)를 점검하는 테스트 코드를 작성하는 것이다.
    - 그 단위가 하나의 함수던 여러 함수가 복잡하게 얽혀 있던 분리하여 테스트할 수 있다면 큰 문제(?)가 안된다고 한다.
- 테스트 스위트는 여러 테스트를 실행하고 그 결과를 보여주는 프로그램이다.
- 테스트를 작성하면 함수를 결정론적으로 만들 수 있게 유도하고 설계 문제를 확인할 수 있다.
- 테스트 프레임워크를 활용하면 결과를 수집하고 격리된 실행 환경 / 병렬 처리 등에 용이하다.

### 3. TDD와 같은 약어 용어를 사용하지 마라

- 우리가 할 일은 너무 많은 생각을 하지 않고 그것들을 따르는 것이 때문에 우리는 관습과 관례를 사랑한다.
- 테스트를 먼저 작성하다보면 테스트 가능한 설계에 대해 고민하게 되므로 일부 유효한 접근이라고 볼 수 있다.
- 하지만 테스트 때문에 고민해서는 안된다. 테스트는 작성하기 가장 쉬운 코드여아하고, 그렇지 않으면 무엇인가 잘못된 것이다.
- 테스트를 먼저 작성하면 매몰비용의 오류가 발생한다. 테스트 코드 역시 종속적으로, 기존의 작성된 테스트 때문에 설계 변경에 매몰 비용이 증가하게 된다.
- 프로토타입을 먼저 구현하고 이후에 테스트를 작성하는 것도 나쁘지는 않다.

### 4. 자신의 이득을 위해 테스트를 작성하라

- 테스트는 매몰 비용의 오류와 반대로 ‘보험’처럼 작용할 수 있다.
- 프로토타입을 만든 후 테스트를 작성하면 코딩할 때 발견하지 못한  문제점들을 파악하고 다시 코드를 리뷰할 수 있도록 도와준다.

### 5. 테스트 대상 결정하기

- 테스트가 버그를 찾는 데 도움이 되지 않는다면 여러분은 이미 실패한 것이다.
    - 프로덕션 코드에서 무작위로 라인을 제거하고 테스트를 다시 실행 했을 때에도 실패한 테스트가 없다면 그 팀의 테스트는 실패했다.
- 경계 값을 위주로 테스트를 해라.
- 테스트 코드 커버리지를 활용하자.

### 6. 테스트를 작성하지 마라

- 사용하지 않는 기능이나 이미 작성된 테스트를 추가로 작성하지 마라
- 모든 테스트를 작성할 필요는 없다.
    - 파레토의 법칙처럼 결과의 80프로는 20퍼센트의 원인에서 나온다.
    - 이는 20퍼센트의 코드 커버리지의 80프로의 버그를 잡을 수 있다는 것을 의미하기도 한다.
    - 스모크 테스트 - 최소한의 동작이 보장되는지 테스트하는 것, 좋은 구성요소(컴포넌트)에 좋은 테스트를 작성하는 것이 커버리지 100프로보다 낫다.
- 컴파일러가 코드를 테스트하도록 하라
    - null safety가 보장되고 높은 강타입 언어를 사용하면 필요없는 테스트와 코드를 제거할 수 있다.
    - 수에 대한 범위 검사를 제거하라 - 적절한 타입을 활용하면 됨

### 8. 테스트 이름 정하기

좋은 테스트 이름은 `입력, 초기상태, 예상 동작` 을 유추할 수 있어야한다.