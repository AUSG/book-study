# 1~2장

# 1장. 근접성 서비스

## 요구사항

- 사용자 위치를 중심으로 주변 사업장을 노출할 수 있어야 함.
- 사업장은 간헐적으로 정보가 수정되며, 즉각적으로 변경되지 않아도 괜찮음

## 구현

- 위치 기반 서비스 컴포넌트가 특히 필요함
- 위치 기반 검색 알고리즘
    - 2차원 검색: 풀색인 및 기능에 한계점 명확
    - 균등격자: 간단하지만 더 많은 기능 포함 어려움
    - 지오해시: 해당 위치를 해시값으로 돌려 해시값의 postfix/prefix를 사용해 효율적으로 위치 관리
        - 특정 위치의 경우 해시값으로 처리할 수 없는 엣지케이스 존재
    - 쿼드트리: 트리형태로 사업장을 묶어 재귀적 분할. 빠르게 해당 위치에 속한 사업장 그룹을 다양하게 보여줄 수 있음
        - 색인 항목을 각 컴퓨팅 자원에서 가지고 있어야 하는데 항상 트리 구조를 만들고 시작하기 때문에 부팅시간이 꽤 걸림
    - 구글 S2
- 스토리지
    - 간단한 조회인 경우 RDBMS 이용
    - 사업장 정보는 잘 변하지 않으니 캐시 이용

# 2장. 주변 친구

## 요구사항

- 사용자 위치를 중심으로 주변 친구를 노출할 수 있어야 함

## 구현

- 소켓서버를 이용해 지속적으로 통신을 하며 상태를 업데이트 시켜야한다.
- 사용자마다 레디스 펍섭 채널을 열어서 위치정보가 업데이트 되면 구독하고 있는 사용자(친구)에게 위치 업데이트 전파
- 스토리지
    - 사용자 정보는 RDBMS 적용
    - 실시간으로 변경해야하므로 사용자 위치는 캐싱하는 것은 트레이드 오프