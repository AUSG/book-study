## 6장 도메인 객체의 생명주기

-   모든 객체에는 생명주기가 있다. 도메인 객체에도 생명주기가 있는데, 이것은 여러 상태 변화를 겪고 갖가지 불변식이 적용된다. 이러한 객체들을 관리하는 데 실패한다면 모델 주도 디자인을 시도하는 것이 쉽게 좌절될 수 있다.
-   도메인 객체의 관리와 관련된 문제는 아래 두 가지 범주로 나뉜다.
    -   생명주기 동안의 무결성 유지하기
    -   생명주기 관리의 복잡성으로 모델이 난해해지는 것을 방지하기
-   AGGREGATE
    -   소유권과 경계를 명확히 정의함으로써 모델을 엄격하게 만들어 객체 간의 연관관계가 혼란스럽게 얽히지 않도록 한다. 이 패턴은 생명주기상의 전 단계에 걸쳐 도메인 객체의 무결성을 유지하는데 매우 중요하다.
    -   데이터 변경의 단위로 다루는 연관 객체의 묵음
    -   ROOT와 BOUNDARY가 존재한다.
        -   BOUNDARY는 AGGREGATE에 무엇이 포함되고 포함되지 않는지를 정의
        -   ROOT는 하나만 존재하며, AGGREGATE에 포함된 특정 ENTITY를 가리킨다
        -   BOUNDARY 내의 객체는 서로 참조 가능하며, 바깥의 객체는 ROOT만 참조 가능하다
        -   ROOT 이외의 ENTITY는 지역 식별성을 가지고, AGGREGATE에서만 구분되면 된다. AGGREGATE BOUNDARY 밖의 객체는 ROOT ENTITY의 컨텍스트 말고는 AGGREGATE의 내부를 볼 수 없기 떄문
    -   ROOT ENTITY는 전역 식별성을 지니며, 궁극적으로 불변식을 검사할 책임이 있다.
    -   ROOT ENTITY는 전역 식별성, 경계 안의 ENTITY는 지역 식별성을 지니며 이러한 지역 식별성을 해당 AGGREGATE 안에서만 유일하다.
    -   AGGREGATE의 경계 밖에서는 ROOT ENTITY를 제외한 AGGREGAT 내부의 구성요소를 참조할 수 없다. ROOT ENTITY가 내부 ENTITY에 대한 참조를 다른 객체에 전달해 줄 수는 있지만 그러한 객체는 전달받은 참조를 일시적으로만 사용할 수 있고, 참조를 계속 보유하고 있을 수는 없다. ROOT는 VO의 복사본을 다른 객체에 전달해 줄 수 있으며, 복사본에서는 어떤 일이 일어나든 문제되지 않는다. 이것은 복사본이 단순한 VALUE에 불과하며, AGGREGATE와는 더 이상 연관관계를 맺지 않을 것이기 때문이다.
    -   데이터베이스 질의를 이용하면 AGGREGATE의 ROOT만 직접적으로 획득할 수 있다. 다른 객체는 모두 AGGREGATE를 탐색해서 발견해야 한다.
    -   AGGREGATE 안의 객체는 다른 AGGREGATE의 ROOT만 참조할 수 있다.
    -   삭제 연산은 AGGREGATE 경계 안의 모든 요소를 한번에 제거해야 한다.
    -   AGGREGATE 경계 안의 어떤 객체를 변경하더라도 전체 AGGREGATE의 불변식은 모두 지켜져야 한다.
-   FACTORY
    -   AGGREGATE를 생성하는 일이 복잡해지거나 내부 구조를 너무 많이 드러내는 경우 FACTORY가 캡슐화를 제공한다.
    -   어떤 객체를 생성하는 것이 그 자체로 주요한 연산이 될 수 있지만 복잡한 조립 연산은 생성된 객체의 책임으로 어울리지 않는다.
    -   복잡한 객체와 AGGREGATE의 인스턴스의 생성 책임을 별도의 객체로 옮겨라. 복잡한 객체를 생성하는 일은 도메인 계층의 책임이지만, 모델을 표현하는 객체의 책임은 아니다.
-   REPOSITORY
    -   AGGREGATE 내부에 존재하는 모든 객체는 ROOT에서부터 탐색을 토대로 접근하는 것 말고는 접근이 금지되어 있다.
    -   특정한 기준으로 객체를 선택하고 속성값이 특정 기준을 만족하는 완전히 인스턴스화된 객체나 객체 컬렉션을 반환하는 메서드를 제공함으로써 실제 저장소와 질의 기술을 캡슐화하라.
    -   실질적으로 직접 접근해야하는 AGGREGATE의 ROOT에 대해서만 REPOSITORY를 제공하고, 모든 객체 저장과 접근은 REPOSITORY에 위임해서 클라이언트가 모델에 집중하게하라.
    -   REPOSITORY의 이점은 아래와 같다.
        -   REPOSITORY는 영속화된 객체를 획득하고 해당 객체의 생명주기를 관리하기 위한 단순한 모델을 클라이언트에게 제시한다.
        -   REPOSITORY는 영속화 기술과 다수의 데이터베이스 전략, 또는 심지어 다수의 데이터 소스로부터 애플리케이션과 도메인 설계를 분리한다.
        -   REPOSITORY는 객체 접근에 관한 설계 결정을 전해준다.
        -   REPOSITORY를 이용하면 테스트에서 사용할 가짜 구현을 손쉽게 대처할 수 있다.
    -   REPOSITORY에 질의할 때는 명세 패턴 이용하라




## 7장 언어의 사용 ( 확장 예제 )

-   화물 해운 시스템 예시를 통해 설명한다



# 더 심층적인 통찰력을 향한 리팩터링

## 8장 도약

-   리팩터링의 효과는 선형적으로 증가하지 않는다.
-   리팩터링은 엔트로피와의 싸움이며 퇴보하는 것을 막는 최전선에 놓여있으며, 가장 중요한 통찰력은 어느 순간에 도약하여 프로젝트 전체로 퍼져나간다

-   관리자의 도움 덕분에 3주동안 리팩터링을 진행했고, 모델 설계를 성공적으로 하여 문제점들을 해소할 수 있었음.



### 기회

-   심층 모델로 도약할 수 있는 기회가 찾아올 때 두려움이 느껴지고 위험이 수반된다.
-   이 길은 순탄하지 않고, 사고방식의 전환이 필요하며 설계의 대부분을 수정해야한다. 하지만 이러한 도약을 통해 가장 중요한 발전이 이루어진다.



### 기본에 집중하라

-   도약을 위해 마비 상태에 빠져서는 안된다.
-   지식탐구와 인내심을 가지고 보편 언어를 만드는 일에 집중해야한다.
-   점진적으로 모델의 깊이를 더하는 개선을 망설이면 안되며, 너무 멀리 내다보려고하다가 마비상태에 빠져서도 안된다.

