## 12장 모델과 디자인 패턴의 연결

-   디자인 패턴을 사용하는 동기와 패턴 자체는 순수하게 기술적인 용어를 사용해서 표현된다. 그러나 일부 설계 요소는 많은 도메인에서 접하게 되는 일반적인 개념과도 부합하므로 도메인 모댈링과 도메인 설계를 아우르는 포괄적인 문맥에도 활용할 수 있다.  
-   프로세스에서 변화하는 부분을 별도의 전략(strategy) 객체로 분리해서 모델에 표현하라. 프로세스의 규칙과 프로세스를 제어하는 행위를 서로 분리하라. STRATEGY 디자인 패턴에 따라 규칙이나 대체 가능한 프로세스를 구현하라. 다양한 방식으로 변형된 전략 객체는 프로세스의 서로 다른 처리 방식을 표현한다.

-   Composition을 이용해서도 도메인 모델을 적절히 구성할 수 있다.

    ![image](https://github.com/shorebirdtech/shorebird/assets/60743304/9e5a4785-02e9-4082-b172-5480fd7c284b)

## 13장 더 심층적인 통찰력을 향한 리팩터링

-   방법론

    - 시작

    - 조사팀

    - 선행 기술
      - 항상 바퀴를 다시 발명할 필요는 없다.
      - 분석 패턴, 디자인 패턴, 수학이나 술어 로직(predicate logic)과 같은 일반적인 정형화 등을 활용하자.

    - 개발자를 위한 설계

    - 타이밍
      - 변경을 완벽하게 정당화할 수 있을 때까지 기다린다면 지나치게 오랫동안 기다린 셈이다.
      - 다음과 같은 경우에 리팩터링을 수행한다.
        - 현재 팀에서 도메인을 이해하고 있는 바가 설계에 표현돼 있지 않은 경우
        - 중요한 개념이 설계상에 암시적으로 표현돼 있는 경우 (그리고 개념을 명확하게 표현할 수 있는 방법이 보이는 경우)
        - 설계상의 중요한 부분을 더욱 유연하게 만들 기회가 보이는 경우

-   불현듯 모델 내에 명백한 결점이 드러나기 시작한다. 모델이 표현할 수 있는 부분에 허점이 보이거나 일부 핵심적인 영역이 불분명해진다. 이는 팀이 새로운 이해 수준에 도달했다는 의미다. 한 단계 향상된 팀의 관점에서 보면 과거 모델이 결함투성이로 보인다. 이런 관점에서 팀은 더 훌륭한 모델을 생각해낼 수 있다.



## 14장 모델의 무결성 유지

![image](https://github.com/shorebirdtech/shorebird/assets/60743304/afc9ab2c-b701-4b8a-a43b-a43d0f31d4d5)

- BOUNDED CONTEXT

  - 규모가 큰 프로젝트에서 개별적인 모델의 코드들이 섞이면 많은 버그가 발생하고 신뢰성이 떨어짐으로, 모델이 적용되는 컨텍스트를 명시적으로 정의하라.

- CONTINUOUS INTEGRATION

  - 다수의 사람이 동일한 BOUNDED CONTEXT 내에서 작업할 경우 모델이 단편화될 가능성이 높다. 팀의 규모가 커지면 문제도 증폭되지만 서너 명 정도에 달하는 소수의 인원으로 구성 된 팀도 심각한 문제에 마주칠 수 있다. 그렇다고 시스템을 더 작은 CONTEXT 로 분할한다면 결 국 가치 있는 수준의 통합과 응집성을 잃게 되는 결과가 초래된다. 때문에 BOUNDED CONTEXT 를 정의했다면 이를 건전한 상태로 유지해야 한다.

  - 통합을 위한 가장 효과적인 프로세스
    - 단계적이고 재생 가능한 병합/빌드 기법
    - 자동화된 태스트 스위트
    - 수정사항이 통합되지 않은 상태로 존재할 수 있는 시간을 적당히 짧게 유지하는 규칙
  - 단편화가 발생했다는 사실을 빠르게 알려줄 수 있는 자동화된 테스트와 함께 모든 코드와 그 밖의 구현 산출물을 빈번하게 병합하는 프로세스를 수립하라. 개념이 각자의 머릿속에서 발전 해감에 따라 모델에 관한 시각의 차이를 해소하기 위해 끊임없이 UBIQUITOUS LANGUAGE를 사용하라.

- CONTEXT MAP

  ![image](https://github.com/shorebirdtech/shorebird/assets/60743304/b185d1b8-db86-4841-aa95-c0ddc09d70ac)

  - 다른 팀에 속한 사람들은 CONTEXT 간의 경계를 인식하지 못할 것이며, 따라서 자신도 모르는 사이에 CONTEXT의 경계를 흐리게 하거나 연결되는 방식을 복잡하게 바꿀 것이다. 서로 다른 CONTEXT를 연결해야 하는 경우 CONTEXT는 서로에게 스며드는 경향이 있다.
  - BOUNDED CONTEXT 간에 코드를 재사용하는 것은 위험하므로 피해야 한다. 기능과 데이터는 번역 과정을 거쳐 통합해야 한다. 서로 다른 컨텍스트 간의 관계를 정의하고 프로젝트상의 모든 모델 컨텍스트를 아우르는 전체적 인 뷰를 만들면 혼란을 줄일 수 있다.
  - 의사소통을 위해 컨텍스트 간의 번역에 대한 윤곽을 명확하게 표현하고 컨텍스트 간에 공유 해야 하는 정보를 강조합으로써 모델과 모델이 만나는 경계 지점을 서술하라. 각 컨텍스트의 현재 영역을 나타내는 지도를 작성하라. 컨텍스트의 배치를 바꾸는 일은 나중에 하라.
  - 번역기는 양 팀에서 합심해서 유지해야 할 유일한 객체다. 설계는 단위 태스트가 용이하게 만들어야 하며, 두 팀에서 그와 같은 목적으로 테스트 스위트를 두고 협업하는 것은 특히 좋은 생각 이다. 그 밖의 사항에 대해서는 두 팀에서 독자적으로 진행해 나갈 수 있다

  ![image](https://github.com/shorebirdtech/shorebird/assets/60743304/db8ad455-d14b-4ec5-b195-60a2c7f3a8c7)

- SHARED KERNEL

  ![image](https://github.com/shorebirdtech/shorebird/assets/60743304/3c80b04a-e687-4680-a752-5e414297cadc)

  - 두 팀 간에 공유하기로 한 도메인 모델의 부분집합을 명시하라. 물론 여기에는 모델의 부분집 합뿐 아니라 모델 요소와 연관된 코드나 데이터베이스 설계의 부분집합까지도 포함된다. 명시적으로 공유하는 부분들은 특별한 상태를 가지며, 다른 팀과의 협의 없이는 변경할 수 없다.

- CUSTOMER / SUPPLIER DEVELOPMENT TEAM

  - 두 팀 간에 명확한 고객 / 공급자 관계를 확립하라. 계획 회의에서 하류 팀이 상류 팀에 대한 고객 역할을 맡게 하라. 하류 요구사항에 대한 작업을 협상하고 이에 대한 예산을 책정해서 모든 이들이 일정과 약속을 이해할 수 있게 하라.
  - 결과로 예상되는 인터페이스를 검증하게 될 자동화된 인수 태스트(acceptance test) 를 함께 개발하라. 이 태스트를 상류 팀의 테스트 스위트에 추가해서 지속적인 통합의 일부로 실행되게 하라. 이러한 테스트를 토대로 상류 팀은 하류 시스템에서 발생할지도 모르는 부수효과를 두려 워하지 않고 자유로이 코드를 변경할 수 있을 것이다.
  - 관계는 고객과 공급자 간의 관계여야 하며, 이는 고객의 요구사항이 가장 중요하다는 것을 의미한다. 하류 팀이 유일한 고객은 아니므로 협의를 거쳐 서로 다른 고객의 요구사항 간에 균형을 맞춰야 한다(그래도 우선순위는 유지해야 한다). 
  - 상류 팀이 하류 시스템을 망가뜨릴지도 모른다는 두려움 없이 코드를 수정하고 하류 팀 이 지속적으로 상류 팀을 감시하지 않고도 자신의 작업에 집중할 수 있게 자동화된 테스트 스위트가 마련돼 있어야 한다.

- CONFORMIST

  - 제공자 팀이 소비자 팀을 케어 할 수 없다면, 소비자 팀은 SEPARATE WAYS, ANTICORRUPTION LAYER, CONFORMIST 중 한가지 전략을 취할 수 있다.
  - 준수가 항상 나쁜 것은 아니다. 맹목적으로 상류 팀의 모델을 준수해서 BOUNDED CONTEXT 간의 번역에 따른 복잡도를 제거하라. CONFORMIST를 따를 경우 하류 팀 설계자들의 설계 형식이 상류 팀에 속박되고 애플리케이션을 위한 이상적인 모델을 만들지는 못해도 통합 자체는 매우 단순해질 수 있다.

- ANTICORRUPTION LAYER

  - 클라이언트 고유의 도메인 모텔 측면에서 기능을 제공할 수 있는 격리 계층을 만들어라. 격리 계층은 기존에 이미 존재하는 인터페이스를 거쳐 다른 시스템과 통신하므로 다른 시스템을 거의 수정하지 않아도 된다.

- SEPARATE WAYS

  - 통합에는 언제나 비용이 많이 든다. 때로는 통합의 혜택이 적은 경우도 있다. 두 기능 간의 관계가 필수적 인 것이 아니라면 두 기능은 서로 관계를 끊을 수도 있다.

- OPEN HOST SERVICE

  - 하위 시스템 접근과 관련된 프로토콜을 일련의 SERVICE로 정의하라. 프로토콜을 공개해서 개발 중인 시스템과 통합하고자 하는 모든 이들이 해당 프로토콜을 사용할 수 있게 하라.

- PUBLISHED LANGUAGE

  - 두 BOUNDED CONTEXT 의 모델 간에 이뤄지는 번역에는 공통의 언어가 필요하다.
