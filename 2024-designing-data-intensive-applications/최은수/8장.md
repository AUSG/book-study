# 분산 시스템의 골칫거리

> 비관주의를 최대한으로 끌어올려 어떤 것이든지 잘못될 가능성이 있다면 잘못된다 고 가정한다

## 결함과 부분 장애
- 한 컴퓨터
  - 상당히 예측 가능한 방식으로 동작
  - 돌아가거나 안돌아가거나
- 네트워크로 연결된 여러 컴퓨터
  - 이상화된 시스템 모델에서 동작하지 않음
  - 어떤 부분은 잘 동작하지만 다른 부분은 그렇지 않음
    - 부분 장애 라고 부름
    - 비결정적
  - 부분 장애 가능성과 비결정성 때문에 분산 시스템이 다루기 어려움

## 클라우드 컴퓨팅과 슈퍼 컴퓨팅

고성능 컴퓨팅
- 보통 가끔씩 계산 상태를 지속성 있는 저장소에 체크포인트로 저장
- 노드 하나에 장애 발생 -> 전체 클러스터 작업 부하 중단 -> 장애가 발생한 노드가 복구된 후 마지막 체크 포인트부터 계산 재시작
- 분산 시스템보다는 단일 노드 컴퓨터에 가까움
- 부분 장애를 전체 장애로 확대

크라우드 컴퓨팅


## 신뢰성 없는 네트워크
해당 책의 분산 시스템 = 비공유 시스템, 네트워크로 연결된 다수의 장비
인터넷과 데이터센터 내부 네트워크는 비동기 패킷 네트워크
- 메세지 도착 보장하지 않음 : 타임아웃으로 문제를 다룸

## 타임아웃과 기약 없는 지연
타임아웃만이 결함을 감지하는 확실한 수단이라면 타임아웃은 얼마나 길어야할까?

타임아웃이 길면 : 기다리는 시간 길어짐
타임아웃이 짧으면 : 결함 빨리 발견 가능, BUT 일시적 느림도 죽었다고 잘못 선언할 수 있음

노드가 실제로 살아있는데 죽었다고 선언하면 동작이 두번 실행될수 있기 때문에 문제가 될 수 있다.

패킷이 d 시간내에 전송되거나 손실되고, 장애가 나지 않은 노드는 항상 요청시간을 r 시간 내에 처리한다고 보장하면
성공한 요청은 모두 2d+r 시간 내에 응답받음. 즉 2d+r을 타임 아웃으로 사용

그렇지만 우리가 사용하는 시스템은 어떤것도 보장하지 않음. 기약없는 지연

## 네트워크 혼잡과 큐 대기
컴퓨터 네트워크에서 패킷 지연의 변동성은 큐 대기 때문인 경우가 많다.
TCP VS UDP
실험적으로 타임아웃을 선택할 수밖에 없다.
지연 변동성을 알아내기 위해선 여러 장비에 걸쳐서 긴 기간에 네트워크 왕복 시간의 분포를 측정해야함
더 좋은 방법
- 고정된 타임아웃 대신 시스템이 지속저으로 응답시간과 변동성을 측정하고 관찰된 응답 시간 분포에 따라 타임아웃을 자동으로 조절하게 하는 것

## 동기 네트워크 대 비동기 네트워크
패킷 전송 지연 시간의 최대치가 고정되어있고 패킷을 유실하지 않는 네트워크에 기댈 수 있다면 분산 시스템 간단해짐!
왜 하드웨어 수준에서 네트워크를 신뢰성있게 만들어서 소프트웨어의 걱정 덜어주지 않는걸까?

전화 네트워크와의 비교
- 극단적 신뢰성
- 동기식
- 제한있는 지연

전화 네트워크의 회선은 고정된 양의 예약된 대역폭이지만, tcp는 가용한 네트워크 대역폭을 기회주의적으로 사용
데이터센터 네트워크와 인터넷은 순간적으로 몰리는 트래픽에 최적화를 위해 패킷을 사용함
회선은 통화를 하는 동안 초당 비트 수가 고정되어있는 음성과 영상통화에 적합
웹페이지 요청, 이메일 전송, 파일 전송은 특별한 대역폭 요구사항이 없음. 

## 단조 시계 대 일 기준 시계
현대 컴퓨터는 최소 두 가지 종류의 시계를 가지고 있음

일 기준 시계
- 직관적으로 시계에 기대하는 일을 함

단조 시계
- 타임아웃이나 서비스 응답시간과 같은 지속 시간을 재는데 적합

잘못된 시계에 대비할 필요가 있다.

## 부산 시스템의 실체
정족수
- 노드는 언제든지 장애가 날 수 있고, 노드 자신이 살아있다고 잘못 판단하는 경우도 있음
- 분산 알고리즘은 노드들간의 투표에 의존한다

리더와 잠금
- 그러나 완전히 신뢰 불가능

비잔틴 문제
- 비잔틴 결함
- 비잔틴 장군 문제
- 비잔틴 내결함성


## 알고리즘
- 시간 : 동기식, 비동기식, 반동기식
- 노드 결함 : 죽으면 멈추는, 죽으면 복구하는, 비잔틴 결함
