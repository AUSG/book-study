# 챕터2 데이터 모델과 질의 언어

> [!note]
> 내 언어의 한계는 내 세계의 한계를 의미한다.
>  - 루트비히 비트겐슈타인, 논리-철학 논고 -


데이터 모델은 소프트웨어가 어떻게 작성되었는지 뿐만 아니라 `문제를 어떻게 생각해야 하는지`에 대해서도 영향을 미친다.

## 데이터 모델
- 관계명 모델
- 문서 모델
- 그래프 기반 데이터 모델


관계형 데이터 모델의 목표
- 비즈니스 데이터 처리
- 트랜잭션 처리
- 일괄 처리

문서 모델의 목표
- 뛰어난 확장성
- 관계형 보다 폭넓은 특수 질의 가능
- 관계형 스키마의 제한 및 동적인 표현력을 위함

객체 관계형 불일치
- JSON으로 표현되는 데이터와 실제 데이터 모델간의 불일치로 발생하는 불편함이 존재
- 특히 관계형 모델에서 이게 두드러지며, 문서 모델에서는 이게 크지 않은 편.
- (데이터 부호화 형식으로 JSON이 가지는 문제도 존재하는 데 이건 4장에서 설명)

다대일과 다대다 관계
- 참조를 통해서 저장하는게 해당 값의 변화에 유연하게 대응가능함
- 관계형 모델에서는 특히나 이렇게 참조값을 가지는 게 잘 표현되는데 반해, 문서 모델에서는 조인에 대한 지원이 약함.
    - 혹은 애플리케이션 레벨에서 조인을 완성해야함.
    - 허나 [이러한 케이스](https://medium.com/musinsa-tech/%EB%AC%B4%EC%8B%A0%EC%82%AC-%EC%84%B1%EC%9E%A5%EA%B3%BC-%ED%95%A8%EA%BB%98-%EA%B1%B0%EB%8C%80%ED%95%B4%EC%A0%B8%EC%98%A8-600%EC%A4%84%EC%A7%9C%EB%A6%AC-%EC%BF%A0%ED%8F%B0-%EC%BF%BC%EB%A6%AC%EC%99%80%EC%9D%98-%EC%95%84%EB%A6%84%EB%8B%A4%EC%9A%B4-%EC%9D%B4%EB%B3%84-e689d7d932b5)처럼 요새는 DB에 복잡한 쿼리를 하기보단, 애플리케이션에서 계산을 하도록 하는 게 유행이라, 이게 큰 단점처럼 다가오진 않는 듯함.

문서 모델에서의 스키마 유연성
- Schema on Write <-> Schema on Read = 정적타입과 동적타입
- 모든 레코드가 다른 구조라면 스키마리스, 같은 구조라서 예상 가능하다면 스키마가 유리하다.


데이터 지역성
> [!note]- 스패너에 대한 설명
> Spanner는 Google에서 개발한 분산형 글로벌 데이터베이스 시스템으로, 높은 가용성과 일관성을 유지하면서 확장성을 제공합니다. Spanner의 독특한 기능 중 하나는 SQL을 지원하면서도 전 세계적으로 분산되어 운영되는 데이터베이스라는 점인데요, 이를 위해 특별한 데이터 모델과 스키마 설계 방법을 제공합니다.
> 당신이 언급한 "스패너 부모 테이블 내에 테이블의 로우를 교차 배치"는 Spanner의 지역성 특성 및 데이터 배치 전략을 설명하는 것입니다. 이를 이해하기 위해서는 Spanner의 몇 가지 핵심 개념을 알아야 합니다.
>
> 1. **테이블 간의 지역성 힌트**: Spanner에서는 부모-자식 관계(외래 키 관계)가 있는 테이블 간의 데이터가 물리적으로 함께 저장될 수 있도록 지역성 힌트를 제공합니다. 이를 통해 관련 데이터가 동일한 위치나 노드에 함께 저장되므로, 쿼리의 효율성을 높이고 지연 시간을 줄일 수 있습니다.
>
> 2. **Interleaved Table (교차 배치 테이블)**: Spanner에서 자식 테이블의 행을 부모 테이블의 행과 교차(interleaved)하여 저장할 수 있습니다. 이는 특정 부모 행에 연관된 자식 행들이 같은 물리적 위치에 저장되어 접근 성능이 향상되는 방식입니다. 데이터를 이러한 방식으로 배치하면, 데이터 액세스 시 필요한 디스크 I/O가 감소하고 네트워크 시간이 줄어드는 장점이 있습니다.
>
>  3. **스키마 정의**: 이러한 교차 배치는 스키마 정의 시 명시적으로 지정됩니다. 예를 들어, 자식 테이블을 정의할 때 "INTERLEAVE IN PARENT" 구문을 사용하여 특정 부모 테이블과의 관계를 나타냅니다.
>
> 이러한 기능으로 인해 Spanner는 대규모 분산 환경에서도 높은 성능을 유지하면서 트랜잭션 일관성을 보장하고, 데이터의 물리적 배치를 최적화하여 관련 데이터에 대한 접근을 빠르게 수행할 수 있습니다.


## 데이터를 위한 질의 언어

- 선언형
    - 알고자 하는 데이터의 패턴, 즉 결과의 조건과 데이터 반환 형태만 제공하면 됨.
- 명령형
    - 특정 순서로 특정 연산을 수행하게끔 컴퓨터에 지시

### 그래프형 데이터 모델


복잡한 다대다 관계를 표현하는 데 있어 좋음. 특히 노드 간의 weight를 줌으로써 단순한 연결 관계 뿐만이 아니라 관계의 정도를 표현도 가능하다.

#### 속성 그래프

각 정점은 다음과 같은 구성요소로 구성됨
- 고유한 식별자
- 유출 간선 집합
- 유입 간선 집합
- 속성 컬렉션(키-값 쌍)

각 간선은 다음과 같은 요소로 구성됨
- 고유한 식별자
- 간선이 시작하는 정점(꼬리 정점)
- 간선이 끝나는 정점(머리 정점)
- 두 정정 간 관계 유형을 설명하는 레이블
- 속성 컬렉션(키-값 쌍)

다른 유형의 관계에 서로 다른 레이블을 사용하면 단일 그래프에 다른 유형의 정보를 저장하면서도 데이터 모델을 깔끔하게 유지 가능

#### SQL의 그래프 질의
SQL에서도 그래프 데이터를 표현할 수 있는데, 그렇다면 SQL을 사용해도 그래프 질의할 수 있을까?
정답은 '예'지만 약간 어렵다.

SQL에서 가변 순회 경로에 대한 질의 개념은 `재귀 공통 테이블 식(with recursive 문)`을 사용해서 표현가능하다.
> [!note]- 나의 경우엔
> POI라는 서비스를 만들고 있는데, 많은 Tree 구조를 가짐. 그렇다보니 recursive문을 사용해서 최상위 root를 파악하는 경우가 있음.


[참고 공유](<https://dnb.s3.ap-northeast-2.amazonaws.com/2024/Amazon+Neptune%EC%9D%84+%ED%99%9C%EC%9A%A9%ED%95%9C+%EB%8F%99%EC%9D%BC+%EC%82%AC%EC%9A%A9%EC%9E%90+%EC%B6%94%EC%A0%95%EC%8B%9C%EC%8A%A4%ED%85%9C+%EA%B5%AC%EC%B6%95(%EC%A1%B0%EC%9E%AC%ED%98%B8-%EB%8B%B9%EA%B7%BC%EB%A7%88%EC%BC%93).pdf>)