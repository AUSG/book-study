## 20장 리다이렉션과 부하 균형
> 리다이렉션 기술은 보통 메시지가 프락시， 캐시， 서버 팜의 특정 웹 서버 중 어디에서 끝나는지 판별하기 위해 사용

### 왜 리다이렉트인가?
- 신뢰할수있는 HTTP 트랜잭션의 수행
- 지연 최소화 
- 네트워크 대역폭 절약
을 원하기 때문에 리다이렉션은 현대 웹에서 피할 수 없다.

- 위의 이유들 때문에 웹 콘텐츠는 흔히 여러 장소에 배포된다
  - 이렇게 하면 한 곳에서 실패한 경우 다른 곳을 이용할 수 있으므로 신뢰성이 개선된다.
    - 또한 클라이언트가 보다 가까운 리소스에 접근할 수 있게 되어 콘텐츠를 더 빨리 받게 되므로 웅답시간도 줄여준다.
    - 뿐만 아니라 목적지 서버가 분산되므로 네트워크 혼잡도 줄어든다.
    - 리다이렉션이란 최적의 분산된 콘텐츠를 찾는 것을 도와주는 기법의 집합이라고 생각할 수 있다.
  - 리다이렉션의 구현에는 부하 균형의 과제가 포함됨
    - 왜냐하면 둘은 서로 공존하기 때문

### 리다이렉트 할 곳
### 리다이렉션 프로토콜의 개요
> 리다이렉션의 목표는 HTTP 메시지를 가용한 웹 서버로 가급적 빨리 보내는 것

### 일반적인 리다이렉션 방법
- HTTP 리다이렉션
  - 몇몇 웹사이트는 HTTP 리다이렉션을 이용해 간단하게 부하를 분산
  - 장점
    - 리다이렉트를 하는 서버가 클라이언트의 아이피 주소를 안다
  - 단점
    - 어떤 서버로 리다이렉트할지 결정하려면 원 서버는 상당히 많은 처리를 해야 한다.
      때로는 거의 페이지 자체를 제공할 때 필요한 것과 거의 같은 양의 처리가 필요하다.
    - 페이지에 접근할 때마다 두 번의 왕복이 필요하기 때문에， 사용자가 더 오래 기다리게 된다.
    - 만약 리다이렉트 서버가 고장나면，사이트도 고장난다.
- DNS 리다이렉션
  - DNS 결정 알고리즘
    - DNS 라운드 로빈
      - 가장 흔하고, 가장 단순한 리다이렉션 기법
      - 웹 서버 팜 전체에 대한 부하의 균형을 유지하기 위해 DNS 호스트 명 분석 기능을 사용
        - 순수한 부하 균형 전략 O, 서버에 대한 클라이언트의 상대적 위치나 서버의 현재 스트레스 고려 X
    - 다중 주소와 라운드 로빈 주소 순환
      - 대부분의 DNS 클라이언트는 그냥 다중 주소 집합의 첫 번째 주소를 사용한다.
      - 부하 균형을 위해， 대부분의 DNS 서버는 룩업이 끝났을 때마다 주소를 순환시킨다.
      - 이 주소 순환을 DNS 라운드 로빈이라 부르기도 한다.
    - 부하 균형을 위한 DNS 라운드 로빈
    - DNS 캐싱의 효과
      - DNS 주소 순환은 부하를 순환시킨다
      - DNS 룩업의 결과는 애플리케이션， 운영체제， 몇몇 기초적인 자식 DNS 서버에 의해 기억되어 재사용될 수 있기 때문이다.
      - 호스트 하나에 대해 한 번의 DNS 룩업을 수행한 뒤， 그 주소를 몇 번이고 다시 사용한다.
      - 그렇게 하면 DNS 룩업의 비용을 줄 일 수 있을 뿐 아니라， 같은 클라이언트와 계속 대화하는 것을 선호하는 서버들도 있기 때문이다.
      - 이러한 이유로 DNS 라운드 로빈은 일반적으로 하나의 클라이언트로 인한 부하를 제대로 분산하지 못한다
      - 그러나 비슷한 요청을 하는 클라이언트의 수가 어느 정도 이상만 된다면， 부하는 모든 서버에 걸쳐 상대적으로잘분산될 것이다.
    - 다른 DNS 기반 리다이렉션 알고리즘
      - 부하 균형 알고리즘, 근접 라우팅 알고리즘, 결함 마스킹 알고리즘
- 임의 캐스팅 어드레싱
  - 임의 캐스트 어드레싱에서， 여러 지리적으로 흩어진 웹 서버들은 정확히 같은 아이피 주소를 갖고 클라이언트의 요청을 클라이언트에서 가장 가까운 서버로 보내주기 위해 백본 라우터의 ‘최단거리’ 라우팅 능력에 의지한다.
  - 동작 방식
    - 웹 서버에게 자신을 인접한 백본 라우터를 향하는 라우터라고 광고하는 것
  - 웹 서버는 라우터 통신 프로토콜을 이용해 자신과 인접한 백본 라우터와 대화 한다.
  - 임의 캐스트 어드레싱은 여전히 실험적인 기법이다.
    - 서버가 라우터의 언어로 말해야함
    - 라우터는 일어날 수 있는 주소 충돌을 다룰 수 있어야함
    - 라우팅 누수 문제를 유발할 수 있음
- 아이피 맥 포워딩
- 아이피 주소 포워딩
- 네트워크 구성요소 제어 프로토콜

### 프락시 리다이렉션 방법
> 콘텐츠에 접근 할 때 프락시를 통할 필요가 있는 경우도 있으며(아마 보안상의 이유로)， 클라이언트가 이용하면 유익한 프락시 캐시가 네트워크에 있을 수도 있다(캐시된 콘텐츠를 받는 것이 원 서버에 직접 가는 것보다 아마 훨씬 빠를 것이기 때문이다).
그러나 웹브라우저와 같은 클라이언트들이 어떻게 프락시로 가는 길을 아는가?

- 명시적 브라우저 설정
- 프락시 자동 설정
- 웹 프락시 자동발견 프로토콜

### 캐시 리다이렉션 방법
- WCCP 리다이렉션

### 인터넷 캐시 프로토콜

### 캐시 배열 라우팅 프로토콜

### 하이퍼텍스트 캐싱 프로토콜
- HTCP 인증
- 캐싱 정책 설정