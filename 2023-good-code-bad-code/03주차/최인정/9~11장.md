
# 좋은 코드 나쁜 코드

> [3주차] 2023-09-09 ~ 2023-09-16 <br>
> 작성일 2023-09-16


## Chapter 9. 코드를 재사용하고 일반화할 수 있도록 하라
- 재사용이 가능하도록 의도적으로 코드를 작성하고 구조화 하는 것이 바람직하다.
- 느슨하게 결합하는 코드
- 간결한 추상화 계층을 만들고 코드를 모듈화 하는 것

### 가정을 주의하라
- 가정은 코드 재사용시 버그를 초래할 수 있다.
- 불필요한 가정을 피하라
    - 섣부를 최적화를 주의
    - 요구사항이 변경되면 버그가 발생할 가능성이 있다.
    - 코드를 작성할 때 필요 이상으로 성능비용과 같은 문제에 주의를 기울이는 경우가 있다.
    - 가정으로 인해 얻는 것은 거의 없고 위험이 늘어난다면 그 가정은 하지 않는 것이 좋다.
- 가정이 필요하면 강제적으로 하라
    - 가정이 깨지지 않게 만들라 : 가정이 깨지면 컴파일되지 않는 방식으로 코드 작성
    - 오류 전달 기술을 사용하라 : 깨지는 것을 불가능하게 만들 수 없는 경우 오류 감지 및 오류 전달 기술을 사용하여 신속하게 실패하도록 코드 작성
    - assert으로 가정을 강제로 확인

### 전역 상태를 주의하라
- 전역변수는 프로그램 내의 모든 콘텍스트에 영향을 미치기 때문에 전역변수를 사용할 때는 누구도 해당 코드를 다른 목적으로 재사용하지 않을 것이라는 암묵적인 가정을 전제한다.
- 전역상태는 코드를 매우 취약하게 만들고 재사용하기도 안전하지 않다.
    - 이점보다 비용이 더 큼
- 전영 상태 대신 공유 상태에 의존성을 주입하라
- 누가 이 코드를 재사용할 때 어떻게 쓸 지 고민해보기

### 기본 반환값을 적절하게 사용하라
- 낮은 층위의 코드의 기본 반환값은 재사용성을 해칠 수 있다.
- 가정은 상위 계층에 영향을 미친다. 낮은 층위의 코드에서 기본값을 반환하면 높은 층위의 코드에 영향을 미치는 가정을 하는 것이 된다.
- 하위 문제를 여러 코드로 분리하라 (상위코드에 영향을 미칠 것을 고려해서)
- 상위 수준의 코드에서 기본 값을 제공하라

### 함수의 매개변수를 주목하라
- 필요 이상으로 매개변수를 받는 함수는 재사용하기 어려울 수 있다.
- 함수는 필요한 것만 매개변수로 받도록 하라
    - 간단, 혼란낮춤

### 제네릭의 사용을 고려하라
- 특정 유형에 의존하면 일반화를 제한한다.

<br>

## Chapter 10. 단위 테스트의 원칙
- 단위 테스트 : 상대적으로 격리된 방식으로 코드의 구별되는 단위를 테스트 하는 것
- 코드의 단위 : 정확히 의미하는 바는 다양할 수 있지만 특정 클래스, 함수, 코드 파일을 의미할 때가 많음
- 중요한 것은 코드를 잘 테스트 하고 이 작업을 유지보수할 수 있는 방법으로 수행하는 점

### 단위 테스트 기초
- 테스트 중인 코드 code under test : '실제 코드'라고도 하고 테스트의 대상이 되는 코드를 의미
- 테스트 코드 : 단위테스트를 구성하는 코드
- 테스트 케이스 : 특정 동작이나 시나리오가 될 수 있음. 준비 arrange, 실행 act, 단언 assert 세 개의 섹션으로 나뉨. (given, when, then)
- 테스트 러너 : 실제로 테스트를 실행하는 도구

### 좋은 단위 테스트는 어떻게 작성할 수 있는가?
- 훼손의 정확한 감지 : 실제로 코드가 훼손된 경우에만 실패해야 한다.
- 세부 구현 사항에 독립적 : 세부 구현 사항을 변경하더라도 테스트 코드는 변경하지 않는 것이 이상적
- 잘 설명되는 실패 : 코드가 잘못되면 테스트는 실패의 원인과 문제점을 명확하게 설명해야 한다.
- 이해할 수 있는 테스트 코드 : 다른 개발자들이 테스트 코드가 정확히 무엇을 테스트하기 위한것이고 테스트가 어떻게 수행되는지 이해할 수 있어야 한다.
- 쉽고 빠르게 실행 : 개발자는 일상 작업 중에 단위 테스트를 자주 실행한다. 단위 테스트가 느리거나 실행이 어려우면 개발 시간이 낭비된다.

<br>

- 훼손의 정확한 감지
    - 코드에 대한 초기 신뢰를 준다.
    - 미래의 훼손을 막아준다
    - 회귀 : 코드 변경으로 인해 잘 돌아가던 기능이 작동하지 않는 것. 이러한 회귀를 탐지할 목적으로 테스트를 실행하는 것을 회귀테스트라고 한다.
    - 플래키 flakey : 테스트 대상 코드가 정상임에도 불구하고 때로는 통과하고 때로는 실패하는 테스트
- 세부 구현 사항에 독립적
    - 일반적으로 개발자가 코드베이스에 가할 수 있는 변경 : 기능적 변화, 리팩터링
    - 리팩터링의 경우 구현 세부사항을 변경하고 있지만 코드의 동작은 변경하지 않으므로 테스트에 영향을 주면 안된다.
    - 기능 변경과 리팩터링을 같이 하지 말라. 
- 잘 설명되는 실패
    - 테스트 케이스는 한 가지 사항만 검사하기 -> 작은 테스트 케이스를 많이
    - 테스트 케이스의 이름 명확하게, 서술적인 이름 사용
    - 무엇이 잘못되었는지 명확하게 설명하는 테스트 실패가 훨씬 더 유용하다.
- 이해할 수 있는 테스트 코드
    - 개발자가 자신이 변경한 사항이 원하는 동작에만 영향을 미친다는 확신을 가지려면 테스트의 어느 부분에 영향을 미치고 있는지, 테스트 코드에 대한 수정이 필요한지 여부를 알 수 있어야 한다.
    - 너무 많은 것을 테스트 하는 것, 너무 많은 공유 테스트 설정을 사용하는 것은 지양
        - 이해하기 어렵고 추론하기 어려운 테스트로 이어질 수 있기 때문
    - 일부 개발자들은 테스트를 코드에 대한 일종의 사용 설명서로 사용하기 때문에 테스트 코드를 이해하기 쉽게 만들어야 한다.
- 쉽고 빠르게 실행
    - 작업속도 절대 지켜! 
    - 테스트가 느리면 테스트가 힘든 작업이 되고, 테스트가 힘들면 하고 싶지 않은 마음이 든다.
    - 테스트를 가능한 쉽고 빠르게 실행할 수 있으면 개발자는 더 효율적으로 작업할 수 있고, 테스트 역시 더 광범위하고 철저해 진다.

### 퍼블릭 API에 집중하되 중요한 동작은 무시하지 말라
- 퍼블릭 API에 집중하면 호출하는 쪽에서 실제로 신경 쓰는 동작을 확인하는 테스트를 작성할 수 밖에 없다.
- 따라서 주어진 입력에 대해 기대하는 값이 반환되는지 확인하는 일련의 테스트 케이스를 작성할 수 있다.
- 중요한 동작이 퍼블릭 API 외부에 있을 수 있다. 
    - 다양한 의존성을 설정하거나 특정 부수 효과가 발생했는지 여부를 확인하는 것
    - 서버와 상호작용하는 코드
    - 데이터베이스에 값을 저장하거나 읽는 코드

### 테스트 더블
- 의존성을 실제로 사용하는 것에 대한 대안
- 테스트 더블을 사용하는 이유
    - 테스트의 단순화
    - 테스트로부터 외부 세계 보호 
        - 사용자는 이상하고 혼란스러운 값을 볼 수 있다.
        - 모니터링 및 로깅에 영향을 미칠 수 있다.
    - 외부로부터 테스트 보호
- mock
    - 클래스나 인터페이스를 시뮬레이션 하는데 멤버 **함수에 대한 호출**을 기록하는 것 외에 어떠한 일도 수행하지 않는다. 
    - 테스트 대상 코드에서 부수효과를 일으키는 의존성을 시뮬레이션하는 데 가장 유용
- stub
    - 함수가 호출되면 미리 정해 놓은 값을 반환함으로써 함수를 시뮬레이션 한다.
    - 특정 멤버 함수를 호출하고 특정값을 반환하도록 의존성을 시뮬레이션 할 수 있다.
    - 테스트 대상 코드가 의존하는 코드로 부터 어떤 값을 받아야 하는 경우 그 의존성을 시뮬레이션 하는데 유용
- mock과 stub은 문제가 될 수 있다.
    - 실제 의존성과 다른 방식으로 동작하도록 설정되면 테스트는 실제적이지 않다.
    - 구현 세부사항과 테스트가 밀접하게 결합하여 리팩터링이 어려워질 수 있다.
- fake
    - 클래스(또는 인터페이스)의 대체 구현체로 테스트에서 안전하게 사용할 수 있다.
    - 실제 의존성의 공개 API를 정확하게 시뮬레이션하지만 구현은 일반적으로 단순한데, 외부 시스템과 통신하는 대신 페이스 내의 멤버 변수의 상태를 저장한다.
    - 보다 실질적인 테스트가 이루어 질 수 있다.
    - 구현 세부 정보로부터 테스트를 분리할 수 있다.
<br>

## Chapter 11. 단위 테스트의 실제

### 기능뿐만 아니라 동작을 시험하라
- 함수당 하나의 테스트 케이스만 있으면 적절하지 않을 때가 많다.
- 각 동작을 테스트하는데 집중하라
    - 각 동작과 함께 여러가지 값과 경계조건 테스트
    - 모든 동작이 테스트되었는지 거듭 확인하라
    - 오류 시나리오를 잊지 말라

### 테스트만을 위해 퍼블릭으로 만들지 말라
- 프라이빗 함수를 테스트하는 것은 바람직하지 않을 때가 많다.
- 퍼블릭 API를 통해 테스트 하라
- 코드를 더 작은 단위로 분할하라

### 한번에 하나의 동작만 테스트하라
- 여러 동작을 한꺼번에 테스트하면 테스트가 제대로 안 될 수 있다.
- 이해하기 쉬운 테스트 코드
- 각 동작은 자체 테스트 케이스에서 테스트하라
- 매개변수를 사용한 테스트

### 공유 설정을 적절하게 사용하라
- 상태 공유
- 설정 공유
- 상태 공유는 문제가 될 수 있다.
- 상태를 공유하지 않거나 초기화 하라
- 설정 공유는 문제가 될 수 있다.
- 중요한 설정은 테스트 케이스 내에서 정의하라
- 설정 공유가 적절한 경우

### 적절한 어서션 확인자를 사용하라
- 부적합한 확인자는 테스트 실패를 잘 설명하지 못할 수 있다.
- 적절한 확인자를 사용하라

### 테스트 용이성을 위해 의존성 주입을 사용하라
- 하드코딩된 의존성은 테스트를 불가능하게 할 수 있다.
- 의존성 주입을 사용하라

### 테스트에 대한 몇 가지 결론
- 통합테스트와 종단간 테스트(E2E 테스트)
- 회귀테스트
- 골든 테스트, 특성화 테스트
- 퍼즈 테스트