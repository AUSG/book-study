# 예측 가능한 코드를 작성하라.
코드가 예측을 벗어나 동작하게 되는 일반적인 몇 가지 경우와 이를 피하기 위한 기술을 알아본다.

## 매직값을 반환하지 말아야 한다.
매직값은 함수의 정상적인 반환 유형에 속하지만, 값 자체로는 특별한 의미를 인지하지 못하기 때문에 정상적인 반환값으로 오인할 수 있다.

### 매직값은 버그를 유발할 수 있다.

과거에는 Optional 타입을 반환하는 것이 불가능했다. 그러기에 -1을 반환했다.

하지만, 매직값을 반환하면 예측을 벗어날 위험이 있으므로 사용하지 않는 것이 가장 바람직하다.

또한 단위 테스트가 이 문제를 발견 못할 수도 있다.

### 해결책: 널, 옵셔널 또는 오류를 반환하라.
문제점은 함수를 호출하는 함수 계약의 세부 조항을 알하야한다는 점이다.

널 또는 옵셔널을 반환하여 이를 인지하고 사용할 수 있다.

### 때때로 매직값이 우연히 발생할 수 있다.
개발자가 자신의 코드에 주어지는 모든 입력과 이러한 입력값 영향을 미칠 수 있을지에 대해 충분히 생각하지 않을 때도 매직값이 반환될 수 있다.

## 널 객체 패턴을 적절히 사용하라.
널값을 반환하는 대신 유효한 값이 반환되어 이후에 실행되는 로직에서 널값으로 인해 시스템에 피해가 가지 않도록 하기 위함이다.

### 빈 컬랙셕을 반환하면 코드가 개선될 수 있다.
널을 매번 검사하는 로직을 줄일 수 있다.

### 빈 문자열을 반환하는 것도 때로는 문제가 될 수 있다.
널 대신 빈 문자열을 반화하는 것이 문제가 될 수 있다.

#### 문자들의 모음으로서의 문자열
문자열이 단순히 문자들의 집합을 위해 사용될 경우, 문제가 되지 않는다.

#### ID로서의 문자열
코드에서 특별한 의미를 가질 경우, 문자열의 존재여부가 실행 논리에 영향을 줄 수 있다.

### 더 복잡한 널 객체는 예측을 벗어날 수 있다.
널 객체 패턴이 정말 적절한 것인지 의식적으로 생각해봐야한다.
널 안정성과 옵셔널을 고려하자.

## 예상치 못한 부수효과를 피하라.

유형)
- 사용자에게 출력 표시
- 파일이나 DB에 무언가를 저장
- 다른 시스템을 호출하여 네트워크 트래픽 발생
- 캐시 업데이트 혹은 무효화

부수효과를 피하는 좋은 방법은 애초에 부수효과가 일어나지 않도록 하는 것이다.

### 분명하고 의도적인 부수 효과는 괜찮다.
부수 효과가 코드의 어떤 부분에서 필요할 때가 있으므로 의도하고 사용하는 것은 좋은 선택이다.

### 예기치 않은 부수 효과는 문제가 될 수 있다.
값을 가져오는 함수에서 다른 함수를 호출해 예기치 않은 부수 효과가 발생한다.

1. 부수효과는 비용이 많이 들 수 있다.
2. 호출한 쪽의 가정을 깨트린다.
3. 다중 스레드 코드의 버그

### 해결책: 부수 효과를 피하거나 그 사실을 분명하게 하라.
예측 가능한 코드를 작성하기 위해 부수효과를 일으키지 않을 수 있다. 만약 핗요할 경우, 그에 대한 명시를 해주는 것이 최선이다.

## 입력 매개변수를 수정하는 것에 주의해라.
함수 내의 입력 매개변수 수정에 따른 부수효과를 알아본다.

### 입력 매개변수를 수정하면 버그를 초래할 수 있다.
입력 받은 객체에는 그 함수에 필요한 정보가 있지만, 함수가 호출된 뒤에도 해당 객체를 다른 용도로 사용할 가능성이 크다.

### 해결책: 변경하기 전에 복사하라.
입력 매개 변수 내의 값을 변경해야하는 경우는 변경 전에 새 자료구조에 복사하는 것이 최선의 방법이다.

## 오해를 일으키는 함수는 작성하지 말라.
오해로 인해 예상을 벗어나는 결과와 버그로 이어지기 쉽다.

### 중요한 입력이 누락되었을 때 아무것도 하지 않으면 놀랄 수 있다.
매개변수가 없더라도 호출할 수 있고 해당 매개변수가 없으면 아무 작업도 수행하지 않는 함수가 있다면, 이 함수가 수행하는 작업에 대해 오해의 소지가 발생한다.

### 해결책: 중요한 입력은 필수 항목으로 만들어라.
중요한 매개변수가 널이 가능한 값을 받아들일 수 있게 한다면 호출하는 쪽에서는 호출하기 전에 널값여부를 확인할 필요가 없다.

## 미래를 대비한 열거형 처리
우리가 의존하는 코드에 ㅐ대해 부실한 가정을 할 경우에도 우리의 예상을 벗어나는 결과를 초래할 수 있다.

### 미래에 추가될 수 있는 열것값을 암묵적으로 처리하는 것은 문제가 될 수 있다.
if 문을 사용해서 처리할 경우, 나중에 다른 값이 추가될 경우에는 문제가 발생한다.

### 해결책: 모든 경우를 처리하는 스위치 문을 사용하라.
스위치문을 통해 명시적으로 처리할 수 있다.

### 기본 케이스를 주의하라.
열거형을 처리하는 스위치 문에 기본 케이스를 추가하면 향후 열거형 값이 암시적으로 처리될 수 있으며 잠재적으로 예기치 않은 문제와 버그가 발생할 수 있다.

기본 케이스에 예외를 발생해라!


## 이 모든 것을 테스트로 해결할 수는 없는가?
이상주의적 주장이다.

- 모든 개발자들은 부지런하지 않다. 즉, 모든 테스트에 대한 성실한 검증이 어렵다.
- 테스트가 항상 실제 상황을 정확하게 시뮬레이션 하는 것은 아니다.
- 테스트 작성이 어려울 수 있다.
