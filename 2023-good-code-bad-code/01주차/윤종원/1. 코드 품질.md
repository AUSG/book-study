<!-- TOC start (generated with https://github.com/derlin/bitdowntoc) -->

- [1. 코드 품질](#1--)
    + [1.1 코드는 어떻게 소프트웨어가 되는가](#11----)
    + [1.2 코드 품질의 목표](#12---)
        - [1.2.1 코드는 작동해야 한다](#121---)
        - [1.2.2 코드는 작동이 멈추면 안 된다](#122-----)
        - [1.2.3 코드는 변경된 요구 사항에 적응할 수 있어야 한다.](#123--------)
        - [1.2.4 코드는 이미 존재하는 기능을 중복 구현해서는 안 된다](#124--------)
    + [1.3 코드 품질의 핵심 요소](#13----)
        - [1.3.1 코드는 읽기 쉬워야 한다](#131----)
        - [1.3.2 코드는 예측 가능해야 한다](#132----)
        - [1.3.3 코드를 오용하기 어렵게 만들라](#133----)
        - [1.3.4 코드를 모듈화하라](#134--)
        - [1.3.5 코드를 재사용 가능하고 일반화할 수 있게 작성하라](#135-------)
        - [1.3.6 테스트가 용이한 코드를 작성하고 제대로 테스트하라](#136------)
    + [1.4 고품질 코드 작성은 일정을 지연시키는가?](#14-----)

<!-- TOC end -->

# 1. 코드 품질

- 고품질 코드는 일반적으로 더 신뢰할 수 있고, 유지보수가 쉬우며, 버그가 적은 소프트웨어를 생산한다.
- 엔지니어가 코드를 작성할 때 내리는 결정들은 일상적이고 작다. 하지만 이러한 작은 결정들이 모여 좋은 소프트웨어인지를 결정한다.

### 1.1 코드는 어떻게 소프트웨어가 되는가

- 코드가 실제 서비스에 배포되는 단계
    1. 개발자가 코드베이스에서 코드를 가져와 로컬에서 변경
    2. 작업이 끝나면 변경한 코드에 대한 검토 요청
    3. 다른 개발자가 이를 보고 코드를 검토하고 필요하다면 변경 요청
    4. 작성자, 검토자 모두 동의하면 코드베이스에 코드를 병합
    5. 병합된 코드를 주기적으로 코드베이스를 배포. 배포 주기는 조직이나 팀마다 다르다.
    6. 만약 코드가 테스트나 컴파일에 실패하면 병합이나 배포를 막음

### 1.2 코드 품질의 목표

- 코드 품질은 실제적인 관심 사항에 근거를 둔다.
- 경우에 따라서 사소하거나, 혹은 세부적인 사항에 관심을 가지는 것처럼 보일 수 있지만 결국 높은 코드 품질의 목표는 **더 나은 소프트웨어를 만드는 것**이다.


- 코드 품질은 파악하기 쉬운 개념이 아니다.
- 어떤 코드를 보고 대충 짠 코드라는 생각이 들었거나, 잘 짠 코드라는 생각이 들었다고 해도 이는 **근거 없는 직감**일 수도 있다.


- 오히려 **코드를 통해 달성하려고 했던 것**이 무엇인지를 파악해보는 것이 더 좋은 기준이 될 수도 있다.
- 코드가 이를 달성하는데 도움이 된다면 고품질의 코드이고, 방해된다면 저품질의 코드이다.


- 필자의 경우 코드를 작성할 때 네 가지 상위 수준 목표를 달성하려고 한다.
    1. 작동해야 한다.
    2. 작동이 멈춰서는 안 된다.
    3. 변화하는 요구 사항에 적응해야 한다.
    4. 이미 존재하는 기능을 또다시 구현해서는 안 된다.

#### 1.2.1 코드는 작동해야 한다

- 코드를 작성하는 이유는 문제를 해결하기 위함이다.
- 따라서 코드는 작성된 목적대로 동작해야 한다.
- 코드는 우리가 해결하려고 한 문제를 실제로 해결해야 한다.
    - 이는 버그가 없다는 것과 같은 의미다.


- 코드가 잘 작동되게 만들고, 이를 평가하기 위해서는 **모든 요구 사항**을 파악할 필요가 있다.

#### 1.2.2 코드는 작동이 멈추면 안 된다

- 코드는 **고립된 환경**에서 혼자 실행되는 것이 아니다.
- 주의하지 않으면 **주변 상황**이 바뀌면서 동작이 멈출 수 있다.


- 예를 들어 다음과 같은 일이 벌어질 수 있다.
    - 의존하는 코드가 변경된다.
    - 새로운 기능이 필요해 코드를 수정해야 한다.
    - 해결하려고 하는 문제가 시간이 지남에 따라 변경된다.
        - 소비자 선호, 비즈니스 요구, 고려해야 할 기술 등등


- 이러한 것들 중 하나가 변경되었다고 제대로 동작하지 않는 코드는 별로 유용한 코드가 아니다.
- **코드가 계속 작동하도록 보장**하는 것은 소프트웨어 엔지니어가 직면하는 큰 과제 중 하나다.
    - 또한 이는 코딩의 **모든 단계**에서 고려해야 할 문제다.
    - **나중에 생각**하거나 **이후에 테스트 몇 개 추가**하면 되겠지 하는 생각은 효과적이지 않다.

#### 1.2.3 코드는 변경된 요구 사항에 적응할 수 있어야 한다.

- 한 번 작성하고 다시는 수정되지 않는 코드는 **거의** 없다.


- 오랜 기간 동안 요구사항이 계속 변한다.
    - 비즈니스 환경이 변한다
    - 사용자 선호가 변한다
    - **가정이 더 이상 유효하지 않다**
    - 새로운 기능이 계속 추가된다


- 요구 사항이 변할 것은 알지만 어떻게 변할지는 알 수 없다.
- **하지만 어떻게 변할지 정화하게 알지 못한다고 해서 변한다는 사실 자체를 완전히 무시해야 하는 것은 아니다**.


- 코드가 변하는 요구사항에 어떻게 적응해야 할지 미리 정확하게 알 수는 없지만 **적응성 높은 코드**를 작성하기 위해 사용할 수 있는 몇 가지 일반적인 기술은 존재한다.

#### 1.2.4 코드는 이미 존재하는 기능을 중복 구현해서는 안 된다

- 하위 문제 중 많은 것들은 이미 다른 사람들이 해결해놨다.


- 이미 구현된 코드를 사용하면 다음과 같은 이점이 있다.
    - 시간과 노력을 절약한다
    - 버그 가능성을 줄여준다
    - 기존 전문지식을 활용한다
    - 코드가 이해하기 쉽다.
        - 다른 개발자도 이미 해당 코드를 접해봤을 확률이 높다


- 이미 있는 코드를 다시 작성하지 않는다는 개념은 양방향으로 적용된다.
    - 어떤 하위 문제를 해결하기 위해 자신이 이미 코드를 작성했다면, 다른 개발자가 동일한 문제를 해결하기 위해 자신만의 코드를 재작성하지 않도록 **쉽게 재사용할 수 있는 방식**으로 코드를 구성해야 한다.

### 1.3 코드 품질의 핵심 요소

- 다음은 **코드 품질의 여섯 가지 핵심 요소**다.
    1. 코드는 읽기 쉬워야 한다
    2. 코드는 예측 가능해야 한다
    3. 코드를 오용하기 어렵게 만들라
    4. 코드를 모듈화하라
    5. 코드를 재사용 가능하고 일반화할 수 있게 작성하라
    6. 테스트가 용이한 코드를 작성하고, 제대로 테스트하라

#### 1.3.1 코드는 읽기 쉬워야 한다

- 우리는 보통 코드를 읽을 때 다음을 알아내려고 노력한다.
    - 코드가 하는 일
    - 어떻게 그 일을 수행하는지
    - (입력이나 상태 등) 어떤 것을 필요로 하는지
    - 코드 실행 결과물


- 코드를 작성하고 나면 언젠간 누군가 그 코드를 읽어야 하는 순간이 온다.


- 코드의 가독성이 떨어진다면
    - 코드를 이해하는데 많은 시간이 걸린다.
    - 코드의 기능에 대해서 잘못 이해하거나 몇 가지 중요한 세부 사항을 놓칠 가능성이 크다.
    - 코드 검토 중에 버그가 발견될 가능성이 작다.
    - 새로운 기능을 추가할 때 새로운 버그가 생길 가능성이 크다.

#### 1.3.2 코드는 예측 가능해야 한다

- 우리는 코드를 보며 우리만의 정신 모델(mental model)을 구축한다.
- 만약 실제 코드가 우리의 정신 모델과 다르더라도 우리는 코드에 의해 일어날 일을 예상하고 있지 않았기 때문에 그 일이 실제로 일어날 줄 알지 못한 채 작업을 진행한다.


- 아무리 좋은 의도를 갖고 있더라도 예상을 벗어난 동작은 위험하다.
- 그 코드를 사용하는 개발자는 그 상황을 알지 못하거나 그 상황에 대처할 생각을 하지 못할 것이다.
- 이러한 문제는 드러나지 않고 있다가 나중에 발견되어 더 큰 문제를 초래할 수도 있다.

#### 1.3.3 코드를 오용하기 어렵게 만들라

- 우리의 코드는 종종 다른 코드에 의해 호출된다.
- 우리는 코드를 호출될 때 다음과 같은 가정들을 한다.
    - 인수가 전달된다.
    - 시스템이 특정 상황에 놓여있다.
- 만약 이러한 가정이 깨지는 순간 코드가 작동하지 않거나 큰 문제가 발생할 수도 있다.


- 코드를 오용하기 어렵게 만들거나 불가능하게 하면 코드가 작동할 뿐만 아니라 계속해서 잘 작동할 가능성을 극대화할 수 있다.
- **코드 계약**이 코드의 오용을 어렵게 만드는데 도움을 주는 근본적인 기술이다.

#### 1.3.4 코드를 모듈화하라

- 모듈화는 개체나 시스템의 구성 요소가 독립적으로 교환되거나 교체될 수 있음을 의미한다.


- 모듈화된 시스템의 주요 특징 중 하나는 **인터페이스**가 잘 정의되어 서로 다른 구성 요소 간 **상호작용하는 지점**이 최소화된다는 것이다.


- 코드를 외부에 의존하지 않고 실행할 수 있는 모듈로 나누면 좋을 때가 많다.
- 이때 두 개의 인접한 모듈 사이의 상호작용은 한 곳에서 일어나고 잘 정의된 인터페이스를 사용한다.


- 이는 변화하는 요구사항에 적응하기 쉬운 코드를 만든다.
    - 한 가지 기능을 변경한다고 해서 다른 부분까지 변경할 필요가 없다.


- 모듈화된 시스템은 일반적으로 다음과 같은 특징을 지닌다.
    - 이해하기 쉽다
    - 추론하기 쉽다
- 그 이유는 다음과 같다.
    - 기능이 **관리 가능한 단위**로 나뉜다.
    - 기능 단위 간 상호작용이 잘 정의되고 **문서화**된다.


- 코드가 모듈화되어 작성되면 계속해서 잘 작동할 가능성이 커진다.
    - 코드가 하는 일을 개발자가 오해할 소지가 적기 때문이다.

#### 1.3.5 코드를 재사용 가능하고 일반화할 수 있게 작성하라

- 재사용성과 일반화성은 비슷하지만 약간 다른 개념이다.
    - 재사용성(reusability)
        - 어떤 문제를 해결할 수 있는 무언가가 여러 가지 다른 상황에서도 사용될 수 있음
        - 문제는 동일하지만 상황이 다르다
        - Ex) 드릴로 벽 뚫기, 천장 뚫기
    - 일반화성(generalizability)
        - 개념적으론 유사하지만 서로 미묘하게 다른 문제들을 해결할 수 있음
        - Ex) 드릴로 벽 뚫기, 나사 돌리기


- 코드는 일단 만들어지면 유지보수에 지속적인 노력과 시간이 들어간다.


- 코드가 재사용할 수 있고 일반화되어 있으면 여러 곳에서 사용할 수 있다.
- 이런 코드는 시간과 노력을 절약해주며 더 신뢰할 수 있다.
    - 실제 서비스 환경에서 이미 시도되고 테스트된 논리를 재사용하기 때문이다.
    - 어떤 버그라 할지라도 이미 발견되고 해결되었을 가능성이 크다


- 모듈화된 코드 역시 더 높은 재사용성과 일반화성을 갖는다.

#### 1.3.6 테스트가 용이한 코드를 작성하고 제대로 테스트하라

- 테스트는 아래와 같은 역할을 할 때가 많다.
    - 버그나 제대로 동작하지 않는 기능을 갖는 코드가 코드베이스에 병합되지 않도록 방지
    - 버그나 제대로 동작하지 않는 기능을 갖는 코드가 배포되지 않도록 막고 서비스 환경에서 실행되지 않도록 보장


- 소프트웨어 개발에서 테스트가 얼마나 중요한지는 아무리 강조해도 지나치지 않다
- 그 이유는 다음과 같다.
    - 소프트웨어 시스템과 코드베이스는 너무 크고 복잡해 한 사람이 모든 세부사항을 알 수 없다
    - 사람은 실수를 하는 존재다


- 이 단원은 두 가지 내용을 내포하고 있다.
    - 테스트가 용이한 코드를 작성하라
    - 제대로 테스트하라


- 테스트(test)
    - 테스트는 수동이나 자동으로 수행된다
    - 테스트 코드를 통해 실제 코드를 돌려봐 작동을 확인한다.
    - 테스트는 여러 가지 수준의 테스트가 존재하는데 아래 세 가지를 흔히 볼 수 있다
        - 단위 테스트(unit test)
            - 개별 함수나 클래스와 같은 작업 단위를 테스트
            - 가장 자주 작업하는 테스트
        - 통합 테스트(integration test)
            - 여러 구성 요소나 시스템을 연결했을 때 잘 동작하는지 확인하는 테스트
        - 종단간 테스트(end-to-end, E2E test)
            - 처음부터 끝까지 전체 소프트웨어 시스템에서 작동의 흐름을 테스트
- 테스트 용이성(testability)
    - 실제 코드가 얼마나 테스트하기 적합한지를 나타낸다.
    - 테스트 용이성은 모듈화와 깊은 관련이 있으며, 모듈화된 코드는 테스트 용이성이 더 좋다.


- 코드를 다 작성하고 나서 테스트에 대해 생각해서는 안 된다.
- 코드를 작성하면서 '어떻게 테스트할 것인가?'를 계속 자문하는 것이 좋다.
- 테스트는 코드 작성의 모든 단계에서 필수적이고 기본적인 부분이다.

### 1.4 고품질 코드 작성은 일정을 지연시키는가?

- 단기적으로는 고품질 코드를 작성하는 데 시간이 더 걸릴 수 있다
- 일반적으로 고품질 코드를 작성하는 것이 중장기적으로는 개발 시간을 단축해준다.
    - 한 번 쓰고 버릴 유틸리티가 아니라면


- 임시변통인 해결책으로 시작하면 더 많은 일을 또 다른 임시변통으로 할 수밖에 없다.


- 서두른다고 빨리할 수 있다고 착각하지 말자

